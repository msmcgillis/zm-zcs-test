version: '3.4'

services:
  perf:
    env_file: .env
    image: ${IMG}
    container_name: perf
    hostname: localhost
    build:
      context: '.'
      dockerfile: 'build/Dockerfile'
    volumes:
      - ./logs:/opt/qa/logs
    configs:
      - source: users.csv
        target: /opt/qa/zm-load-testing/config/users.csv
    secrets:
      - source: env.prop
        target: /opt/qa/zm-load-testing/config/env.prop
    entrypoint:
      - /zimbra/init
      - --shutdown
      - "no"
    network_mode: "host"

secrets:
    env.prop:
        file: ./.secrets/env.prop

configs:
    users.csv:
        file: ./.config/users.csv
